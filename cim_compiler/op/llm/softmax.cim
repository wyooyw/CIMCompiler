
def softmax(
    x< <-1>, fp16, __ANY__>,
    score< <-1>, fp16, __ANY__>,
    max_x< <1>, fp16, __ANY__>,
    sum_exp_x< <1>, fp16, __ANY__>,
    temp< <-1>, fp16, __ANY__>
) {
    // local softmax
    SIMD({{simd.reduce_max}}, x, max_x);
    SIMD({{simd.vs_sub}}, x, max_x, x);
    SIMD({{simd.v_exp}}, x, x);
    reduce_sum(x, temp);
    Trans(temp[0], sum_exp_x);
    SIMD({{simd.vs_div}}, x, sum_exp_x, score);
}
